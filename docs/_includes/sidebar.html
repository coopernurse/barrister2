<aside class="sidebar" id="sidebar">
  {% for section in site.data.navigation %}
    <div class="sidebar__section">
      {% if section.title %}
        <h3 class="sidebar__title">{{ section.title }}</h3>
      {% endif %}

      {% if section.children %}
        <ul class="sidebar__nav">
          {% for child in section.children %}
            {% assign child_url = child.url | relative_url %}
            {% assign page_url = page.url | relative_url %}

            {% if child_url == page_url or child_url == page_url | append: '/' %}
              <li><a href="{{ child_url }}" class="active">{{ child.title }}</a></li>
            {% else %}
              <li><a href="{{ child_url }}">{{ child.title }}</a></li>
            {% endif %}

            {% if child.children %}
              <ul>
                {% for grandchild in child.children %}
                  {% assign grandchild_url = grandchild.url | relative_url %}
                  {% assign page_url = page.url | relative_url %}

                  {% if grandchild_url == page_url or grandchild_url == page_url | append: '/' %}
                    <li><a href="{{ grandchild_url }}" class="active">{{ grandchild.title }}</a></li>
                  {% else %}
                    <li><a href="{{ grandchild_url }}">{{ grandchild.title }}</a></li>
                  {% endif %}
                {% endfor %}
              </ul>
            {% endif %}
          {% endfor %}
        </ul>
      {% elsif section.url %}
        <ul class="sidebar__nav">
          {% assign section_url = section.url | relative_url %}
          {% assign page_url = page.url | relative_url %}

          {% if section_url == page_url or section_url == page_url | append: '/' %}
            <li><a href="{{ section_url }}" class="active">{{ section.title }}</a></li>
          {% else %}
            <li><a href="{{ section_url }}">{{ section.title }}</a></li>
          {% endif %}
        </ul>
      {% endif %}
    </div>
  {% endfor %}
</aside>
